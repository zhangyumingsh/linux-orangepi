// SPDX-License-Identifier: GPL-2.0+
/*
 * FB driver for the hd43017 LCD Controller
 *
 * Copyright (c) 2024 Falcon 
 * 
 * 
 */

#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/delay.h>
#include <video/mipi_display.h>

#include "fbtft.h"

#define DRVNAME	"fb_nv4301"
#define WIDTH		480
#define HEIGHT		272


static const s16 default_init_sequence[] = {

	
//	-1, 0xff , 0xa5 ,
//	-1, 0xE7 , 0x10 ,
//	-1, 0x35 , 0x01 ,
//	-1, 0x3A , 0x01 ,
//	-1, 0x40 , 0x01 ,
//	-1, 0x41 , 0x01 ,
//	-1, 0x55 , 0x01 ,
//	-1, 0x44 , 0x15 ,
//	-1, 0x45 , 0x15 ,
//	-1, 0x7d , 0x03 ,
//	-1, 0xc1 , 0xab ,
//	-1, 0xc2 , 0x17 ,
//	-1, 0xc3 , 0x10 ,
//	-1, 0xc6 , 0x3a ,
//	-1, 0xc7 , 0x25 ,
//	-1, 0xc8 , 0x11 ,
//	-1, 0x7a , 0x49 ,
//	-1, 0x6f , 0x2f ,
//	-1, 0x78 , 0x4b ,
//	-1, 0x73 , 0x08 ,
//	-1, 0x74 , 0x12 ,
//	-1, 0xc9 , 0x00 ,
//	-1, 0x67 , 0x11 ,
//	-1, 0x51 , 0x20 ,
//	-1, 0x52 , 0x7c ,
//	-1, 0x53 , 0x1c ,
//	-1, 0x54 , 0x77 ,
//	-1, 0x46 , 0x0a ,
//	-1, 0x47 , 0x2a ,
//	-1, 0x48 , 0x0a ,
//	-1, 0x49 , 0x1a ,
//	-1, 0x56 , 0x43 ,
//	-1, 0x57 , 0x42 ,
//	-1, 0x58 , 0x3c ,
//	-1, 0x59 , 0x64 ,
//	-1, 0x5a , 0x41 ,
//	-1, 0x5b , 0x3c ,
//	-1, 0x5c , 0x02 ,
//	-1, 0x5d , 0x3c ,
//	-1, 0x5e , 0x1f ,
//	-1, 0x60 , 0x80 ,
//	-1, 0x61 , 0x3f ,
//	-1, 0x62 , 0x21 ,
//	-1, 0x63 , 0x07 ,
//	-1, 0x64 , 0xe0 ,
//	-1, 0x65 , 0x01 ,
//	-1, 0xca , 0x20 ,
//	-1, 0xcb , 0x52 ,
//	-1, 0xcc , 0x10 ,
//	-1, 0xcD , 0x42 ,
//	-1, 0xD0 , 0x20 ,
//	-1, 0xD1 , 0x52 ,
//	-1, 0xD2 , 0x10 ,
//	-1, 0xD3 , 0x42 ,
//	-1, 0xD4 , 0x0a ,
//	-1, 0xD5 , 0x32 ,
//	-1, 0xe5 , 0x06 ,
//	-1, 0xe6 , 0x00 ,
//	-1, 0x6e , 0x14 ,
//	-1, 0x80 , 0x04 , //gamma
//	-1, 0xA0 , 0x00 ,
//	-1, 0x81 , 0x07 ,
//	-1, 0xA1 , 0x05 ,
//	-1, 0x82 , 0x06 ,
//	-1, 0xA2 , 0x04 ,
//	-1, 0x83 , 0x39 ,
//	-1, 0xA3 , 0x39 ,
//	-1, 0x84 , 0x3a ,
//	-1, 0xA4 , 0x3a ,
//	-1, 0x85 , 0x3f ,
//	-1, 0xA5 , 0x3f ,
//	-1, 0x86 , 0x2c ,
//	-1, 0xA6 , 0x2a ,
//	-1, 0x87 , 0x43 ,
//	-1, 0xA7 , 0x47 ,
//	-1, 0x88 , 0x08 ,
//	-1, 0xA8 , 0x08 ,
//	-1, 0x89 , 0x0f ,
//	-1, 0xA9 , 0x0f ,
//	-1, 0x8a , 0x17 ,
//	-1, 0xAa , 0x17 ,
//	-1, 0x8b , 0x10 ,
//	-1, 0xAb , 0x10 ,
//	-1, 0x8c , 0x16 ,
//	-1, 0xAc , 0x16 ,
//	-1, 0x8d , 0x14 ,
//	-1, 0xAd , 0x14 ,
//	-1, 0x8e , 0x11 ,
//	-1, 0xAe , 0x11 ,
//	-1, 0x8f , 0x14 ,
//	-1, 0xAf , 0x14 ,
//	-1, 0x90 , 0x06 ,
//	-1, 0xB0 , 0x06 ,
//	-1, 0x91 , 0x0f ,
//	-1, 0xB1 , 0x0f ,
//	-1, 0x92 , 0x16 ,
//	-1, 0xB2 , 0x16 ,
//	-1, 0xff , 0x00 ,

//	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,
//	-1, MIPI_DCS_SOFT_RESET,
//	-2, 50,
//	-1, MIPI_DCS_SET_DISPLAY_OFF,
//	-2, 200,	
//	-1, MIPI_DCS_SOFT_RESET,
//	-2, 120,
//	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,
//	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,
//	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,

	-1, 0xff ,0xa5 ,
	-1, 0xE7 ,0x10 ,
	-1, 0x35 ,0x00 ,
	-1, 0x3A ,0x01 ,
	-1, 0x40 ,0x01 ,
	-1, 0x41 ,0x03 ,
	-1, 0x36 ,0x0 ,// 0xc0
	-1, 0x44 ,0x15 ,
	-1, 0x45 ,0x15 ,
	-1, 0x7d ,0x03 ,
	-1, 0xc1 ,0xab ,
	-1, 0xc2 ,0x17 ,
	-1, 0xc3 ,0x10 ,
	-1, 0xc6 ,0x3a ,
	-1, 0xc7 ,0x25 ,
	-1, 0xc8 ,0x11 ,
	-1, 0x6f ,0x2f ,
	-1, 0x78 ,0x4b ,
	-1, 0x7a ,0x49 ,
	-1, 0xc9 ,0x00 ,
	-1, 0x51 ,0x20 ,
	-1, 0x52 ,0x7c ,
	-1, 0x53 ,0x1c ,
	-1, 0x54 ,0x77 ,
	-1, 0x46 ,0x0a ,
	-1, 0x47 ,0x2a ,
	-1, 0x48 ,0x0a ,
	-1, 0x49 ,0x1a ,
	-1, 0x56 ,0x43 ,
	-1, 0x57 ,0x42 ,
	-1, 0x58 ,0x3c ,
	-1, 0x59 ,0x64 ,
	-1, 0x5a ,0x41 ,
	-1, 0x5b ,0x3c ,
	-1, 0x5c ,0x02 ,
	-1, 0x5d ,0x3c ,
	-1, 0x5e ,0x1f ,
	-1, 0x60 ,0x80 ,
	-1, 0x61 ,0x3f ,
	-1, 0x62 ,0x21 ,
	-1, 0x63 ,0x07 ,
	-1, 0x64 ,0xe0 ,
	-1, 0x65 ,0x01 ,
	-1, 0xca ,0x20 ,
	-1, 0xcb ,0x52 ,
	-1, 0xcc ,0x10 ,
	-1, 0xcD ,0x42 ,
	-1, 0xD0 ,0x20 ,
	-1, 0xD1 ,0x52 ,
	-1, 0xD2 ,0x10 ,
	-1, 0xD3 ,0x42 ,
	-1, 0xD4 ,0x0a ,
	-1, 0xD5 ,0x32 ,
	-1, 0xe5 ,0x05 ,
	-1, 0xe6 ,0x00 ,
	-1, 0x6e ,0x14 ,
	-1, 0x80 ,0x04 ,
	-1, 0xA0 ,0x00 ,
	-1, 0x81 ,0x07 ,
	-1, 0xA1 ,0x05 ,
	-1, 0x82 ,0x06 ,
	-1, 0xA2 ,0x04 ,
	-1, 0x83 ,0x39 ,
	-1, 0xA3 ,0x39 ,
	-1, 0x84 ,0x3a ,
	-1, 0xA4 ,0x3a ,
	-1, 0x85 ,0x3f ,
	-1, 0xA5 ,0x3f ,
	-1, 0x86 ,0x2c ,
	-1, 0xA6 ,0x2a ,
	-1, 0x87 ,0x43 ,
	-1, 0xA7 ,0x47 ,
	-1, 0x88 ,0x08 ,
	-1, 0xA8 ,0x08 ,
	-1, 0x89 ,0x0f ,
	-1, 0xA9 ,0x0f ,
	-1, 0x8a ,0x17 ,
	-1, 0xAa ,0x17 ,
	-1, 0x8b ,0x10 ,
	-1, 0xAb ,0x10 ,
	-1, 0x8c ,0x16 ,
	-1, 0xAc ,0x16 ,
	-1, 0x8d ,0x14 ,
	-1, 0xAd ,0x14 ,
	-1, 0x8e ,0x11 ,
	-1, 0xAe ,0x11 ,
	-1, 0x8f ,0x14 ,
	-1, 0xAf ,0x14 ,
	-1, 0x90 ,0x06 ,
	-1, 0xB0 ,0x06 ,
	-1, 0x91 ,0x0f ,
	-1, 0xB1 ,0x0f ,
	-1, 0x92 ,0x16 ,
	-1, 0xB2 ,0x16 ,	
	-1, 0xff ,0x00 ,
	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,
	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,
	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,
	-1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xaa,0xaa,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0xF,0x0,0xF,0x0,

	
	-1, MIPI_DCS_EXIT_SLEEP_MODE,
	-2, 50,
	/* DISP_ON */
	-1, MIPI_DCS_SET_DISPLAY_ON,
	-3
};

static int init_display(struct fbtft_par *par)
{
	
	gpiod_set_value_cansleep(par->gpio.dc, 1);
	mdelay(20);
	gpiod_set_value_cansleep(par->gpio.dc, 0);
	msleep(200);
	gpiod_set_value_cansleep(par->gpio.dc, 1);
	mdelay(120);
		
	write_reg(par, 0xff , 0xa5 );
	write_reg(par, 0xE7 , 0x10 );
	write_reg(par, 0x35 , 0x00 );
	write_reg(par, 0x3A , 0x01 );
	write_reg(par, 0x40 , 0x00 );
	write_reg(par, 0x41 , 0x02 );
	write_reg(par, 0x55 , 0x01 );
	write_reg(par, 0x44 , 0x15 );
	write_reg(par, 0x45 , 0x15 );
	write_reg(par, 0x7d , 0x03 );
	write_reg(par, 0xc1 , 0xbb );
	write_reg(par, 0xc2 , 0x13 );
	write_reg(par, 0xc3 , 0x10 );
	write_reg(par, 0xc6 , 0x3e );
	write_reg(par, 0xc7 , 0x25 );
	write_reg(par, 0xc8 , 0x11 );
	write_reg(par, 0x7a , 0x69 );
	write_reg(par, 0x6f , 0x44 );
	write_reg(par, 0x78 , 0x70 );
	write_reg(par, 0x73 , 0x08 );
	write_reg(par, 0x74 , 0x12 );
	write_reg(par, 0xc9 , 0x00 );
	write_reg(par, 0x67 , 0x11 );
	write_reg(par, 0x51 , 0x4b );
	write_reg(par, 0x52 , 0x7c );
	write_reg(par, 0x53 , 0x45 );
	write_reg(par, 0x54 , 0x77 );
	write_reg(par, 0x46 , 0x0a );
	write_reg(par, 0x47 , 0x2a );
	write_reg(par, 0x48 , 0x0a );
	write_reg(par, 0x49 , 0x1a );
	write_reg(par, 0x56 , 0x43 );
	write_reg(par, 0x57 , 0x42 );
	write_reg(par, 0x58 , 0x3c );
	write_reg(par, 0x59 , 0x64 );
	write_reg(par, 0x5a , 0x41 );
	write_reg(par, 0x5b , 0x3c );
	write_reg(par, 0x5c , 0x02 );
	write_reg(par, 0x5d , 0x3c );
	write_reg(par, 0x5e , 0x1f );
	write_reg(par, 0x60 , 0x80 );
	write_reg(par, 0x61 , 0x3f );
	write_reg(par, 0x62 , 0x21 );
	write_reg(par, 0x63 , 0x07 );
	write_reg(par, 0x64 , 0xe0 );
	write_reg(par, 0x65 , 0x01 );
	write_reg(par, 0xca , 0x20 );
	write_reg(par, 0xcb , 0x52 );
	write_reg(par, 0xcc , 0x10 );
	write_reg(par, 0xcD , 0x42 );
	write_reg(par, 0xD0 , 0x20 );
	write_reg(par, 0xD1 , 0x52 );
	write_reg(par, 0xD2 , 0x10 );
	write_reg(par, 0xD3 , 0x42 );
	write_reg(par, 0xD4 , 0x0a );
	write_reg(par, 0xD5 , 0x32 );
	write_reg(par, 0xe5 , 0x06 );
	write_reg(par, 0xe6 , 0x00 );
	write_reg(par, 0xf8 , 0x06 );
	write_reg(par, 0xf9 , 0x00 );
	write_reg(par, 0x80 , 0x00 );
	write_reg(par, 0xA0 , 0x00 );
	write_reg(par, 0x81 , 0x01 );
	write_reg(par, 0xA1 , 0x01 );
	write_reg(par, 0x82 , 0x01 );
	write_reg(par, 0xA2 , 0x01 );
	write_reg(par, 0x86 , 0x34 );
	write_reg(par, 0xA6 , 0x34 );
	write_reg(par, 0x87 , 0x3C );
	write_reg(par, 0xA7 , 0x3D );
	write_reg(par, 0x83 , 0x22 );
	write_reg(par, 0xA3 , 0x21 );
	write_reg(par, 0x84 , 0x20 );
	write_reg(par, 0xA4 , 0x20 );
	write_reg(par, 0x85 , 0x28 );
	write_reg(par, 0xA5 , 0x28 );
	write_reg(par, 0x88 , 0x08 );
	write_reg(par, 0xA8 , 0x08 );
	write_reg(par, 0x89 , 0x10 );
	write_reg(par, 0xA9 , 0x10 );
	write_reg(par, 0x8a , 0x18 );
	write_reg(par, 0xAa , 0x18 );
	write_reg(par, 0x8b , 0x13 );
	write_reg(par, 0xAb , 0x12 );
	write_reg(par, 0x8c , 0x18 );
	write_reg(par, 0xAc , 0x18 );
	write_reg(par, 0x8d , 0x1F );
	write_reg(par, 0xAd , 0x0C );
	write_reg(par, 0x8e , 0x14 );
	write_reg(par, 0xAe , 0x13 );
	write_reg(par, 0x8f , 0x16 );
	write_reg(par, 0xAf , 0x15 );
	write_reg(par, 0x90 , 0x08 );
	write_reg(par, 0xB0 , 0x04 );
	write_reg(par, 0x91 , 0x0F );
	write_reg(par, 0xB1 , 0x0F );
	write_reg(par, 0x92 , 0x16 );
	write_reg(par, 0xB2 , 0x15 );
	write_reg(par, 0xff , 0x00 );
	
	write_reg(par, 0x11);
	mdelay(120);
	write_reg(par, 0x29);
	mdelay(20);


//	write_reg(par , 0xff ,0xa5 );
//	write_reg(par , 0xE7 ,0x10 );
//	write_reg(par , 0x35 ,0x01 );
//	write_reg(par , 0x3A ,0x01 );
//	write_reg(par , 0x40 ,0x01 );
//	write_reg(par , 0x41 ,0x03 );
//	write_reg(par , 0x55 ,0x01 );
//	write_reg(par , 0x44 ,0x15 );
//	write_reg(par , 0x45 ,0x15 );
//	write_reg(par , 0x7d ,0x03 );
//	write_reg(par , 0xc1 ,0xab );
//	write_reg(par , 0xc2 ,0x17 );
//	write_reg(par , 0xc3 ,0x10 );
//	write_reg(par , 0xc6 ,0x3a );
//	write_reg(par , 0xc7 ,0x25 );
//	write_reg(par , 0xc8 ,0x11 );
//	write_reg(par , 0x7a ,0x49 );
//	write_reg(par , 0x6f ,0x2f );
//	write_reg(par , 0x78 ,0x4b );
//	write_reg(par , 0x73 ,0x08 );
//	write_reg(par , 0x74 ,0x12 );
//	write_reg(par , 0xc9 ,0x00 );
//	write_reg(par , 0x67 ,0x11 );
//	write_reg(par , 0x51 ,0x20 );
//	write_reg(par , 0x52 ,0x7c );
//	write_reg(par , 0x53 ,0x1c );
//	write_reg(par , 0x54 ,0x77 );
//	write_reg(par , 0x46 ,0x0a );
//	write_reg(par , 0x47 ,0x2a );
//	write_reg(par , 0x48 ,0x0a );
//	write_reg(par , 0x49 ,0x1a );
//	write_reg(par , 0x56 ,0x43 );
//	write_reg(par , 0x57 ,0x42 );
//	write_reg(par , 0x58 ,0x3c );
//	write_reg(par , 0x59 ,0x64 );
//	write_reg(par , 0x5a ,0x41 );
//	write_reg(par , 0x5b ,0x3c );
//	write_reg(par , 0x5c ,0x02 );
//	write_reg(par , 0x5d ,0x3c );
//	write_reg(par , 0x5e ,0x1f );
//	write_reg(par , 0x60 ,0x80 );
//	write_reg(par , 0x61 ,0x3f );
//	write_reg(par , 0x62 ,0x21 );
//	write_reg(par , 0x63 ,0x07 );
//	write_reg(par , 0x64 ,0xe0 );
//	write_reg(par , 0x65 ,0x01 );
//	write_reg(par , 0xca ,0x20 );
//	write_reg(par , 0xcb ,0x52 );
//	write_reg(par , 0xcc ,0x10 );
//	write_reg(par , 0xcD ,0x42 );
//	write_reg(par , 0xD0 ,0x20 );
//	write_reg(par , 0xD1 ,0x52 );
//	write_reg(par , 0xD2 ,0x10 );
//	write_reg(par , 0xD3 ,0x42 );
//	write_reg(par , 0xD4 ,0x0a );
//	write_reg(par , 0xD5 ,0x32 );
//	write_reg(par , 0xe5 ,0x06 );
//	write_reg(par , 0xe6 ,0x00 );
//	write_reg(par , 0x6e ,0x14 );
//	write_reg(par , 0x80 ,0x04 );
//	write_reg(par , 0xA0 ,0x00 );
//	write_reg(par , 0x81 ,0x07 );
//	write_reg(par , 0xA1 ,0x05 );
//	write_reg(par , 0x82 ,0x06 );
//	write_reg(par , 0xA2 ,0x04 );
//	write_reg(par , 0x83 ,0x39 );
//	write_reg(par , 0xA3 ,0x39 );
//	write_reg(par , 0x84 ,0x3a );
//	write_reg(par , 0xA4 ,0x3a );
//	write_reg(par , 0x85 ,0x3f );
//	write_reg(par , 0xA5 ,0x3f );
//	write_reg(par , 0x86 ,0x2c );
//	write_reg(par , 0xA6 ,0x2a );
//	write_reg(par , 0x87 ,0x43 );
//	write_reg(par , 0xA7 ,0x47 );
//	write_reg(par , 0x88 ,0x08 );
//	write_reg(par , 0xA8 ,0x08 );
//	write_reg(par , 0x89 ,0x0f );
//	write_reg(par , 0xA9 ,0x0f );
//	write_reg(par , 0x8a ,0x17 );
//	write_reg(par , 0xAa ,0x17 );
//	write_reg(par , 0x8b ,0x10 );
//	write_reg(par , 0xAb ,0x10 );
//	write_reg(par , 0x8c ,0x16 );
//	write_reg(par , 0xAc ,0x16 );
//	write_reg(par , 0x8d ,0x14 );
//	write_reg(par , 0xAd ,0x14 );
//	write_reg(par , 0x8e ,0x11 );
//	write_reg(par , 0xAe ,0x11 );
//	write_reg(par , 0x8f ,0x14 );
//	write_reg(par , 0xAf ,0x14 );
//	write_reg(par , 0x90 ,0x06 );
//	write_reg(par , 0xB0 ,0x06 );
//	write_reg(par , 0x91 ,0x0f );
//	write_reg(par , 0xB1 ,0x0f );
//	write_reg(par , 0x92 ,0x16 );
//	write_reg(par , 0xB2 ,0x16 );
//	write_reg(par , 0xff ,0x00 );
//	write_reg(par , 0x11 );
//	mdelay(10);	
//	write_reg(par , 0x29 );
//	mdelay(10);
	
	write_reg(par, MIPI_DCS_SET_DISPLAY_ON);
	mdelay(120);
	write_reg(par, MIPI_DCS_WRITE_MEMORY_START);	
	return 0;
	
}

static int set_gamma(struct fbtft_par *par, u32 *curves)
{
//	write_reg(par,  0x80 , 0x04 ); ///gamma
//	write_reg(par,  0xA0 , 0x00 );
//	write_reg(par,  0x81 , 0x07 );
//	write_reg(par,  0xA1 , 0x05 );
//	write_reg(par,  0x82 , 0x06 );
//	write_reg(par,  0xA2 , 0x04 );
//	write_reg(par,  0x83 , 0x39 );
//	write_reg(par,  0xA3 , 0x39 );
//	write_reg(par,  0x84 , 0x3a );
//	write_reg(par,  0xA4 , 0x3a );
//	write_reg(par,  0x85 , 0x3f );
//	write_reg(par,  0xA5 , 0x3f );
//	write_reg(par,  0x86 , 0x2c );
//	write_reg(par,  0xA6 , 0x2a );
//	write_reg(par,  0x87 , 0x43 );
//	write_reg(par,  0xA7 , 0x47 );
//	write_reg(par,  0x88 , 0x08 );
//	write_reg(par,  0xA8 , 0x08 );
//	write_reg(par,  0x89 , 0x0f );
//	write_reg(par,  0xA9 , 0x0f );
//	write_reg(par,  0x8a , 0x17 );
//	write_reg(par,  0xAa , 0x17 );
//	write_reg(par,  0x8b , 0x10 );
//	write_reg(par,  0xAb , 0x10 );
//	write_reg(par,  0x8c , 0x16 );
//	write_reg(par,  0xAc , 0x16 );
//	write_reg(par,  0x8d , 0x14 );
//	write_reg(par,  0xAd , 0x14 );
//	write_reg(par,  0x8e , 0x11 );
//	write_reg(par,  0xAe , 0x11 );
//	write_reg(par,  0x8f , 0x14 );
//	write_reg(par,  0xAf , 0x14 );
//	write_reg(par,  0x90 , 0x06 );
//	write_reg(par,  0xB0 , 0x06 );
//	write_reg(par,  0x91 , 0x0f );
//	write_reg(par,  0xB1 , 0x0f );
//	write_reg(par,  0x92 , 0x16 );
//	write_reg(par,  0xB2 , 0x16 );
	
	printk(KERN_CRIT"falcon gamma function exec -----------\n");
	return 0;
	
}

static void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)
{
	write_reg(par, MIPI_DCS_SET_COLUMN_ADDRESS,
		  xs >> 8, xs & 0xff, xe >> 8, xe & 0xff);

	write_reg(par, MIPI_DCS_SET_PAGE_ADDRESS,
		  ys >> 8, ys & 0xff, ye >> 8, ye & 0xff);

	write_reg(par, MIPI_DCS_WRITE_MEMORY_START);
}

static int set_var(struct fbtft_par *par)
{
	switch (par->info->var.rotate) {
//	case 270:
//		write_reg(par, 0x36, 0xa0 );
//		break;
//	case 180:
//		write_reg(par, 0x36, 0x0  );
//		break;
//	case 90:
//		write_reg(par, 0x36, 0x60 );
//		break;
//	default:
//		write_reg(par, 0x36, 0xC0 );
//		break;
	case 270:
		//write_reg(par, 0x36, 0xa0 ); //rgb
		write_reg(par, 0x36, 0x60 ); //rgb
		break;
	case 180:
		//write_reg(par, 0x36, 0x0  ); //rgb
		write_reg(par, 0x36, 0xC0 ); //rgb
		break;
	case 90:
		//write_reg(par, 0x36, 0x60 ); //rgb
		write_reg(par, 0x36, 0xa0 ); //rgb
		break;
	default:
		//write_reg(par, 0x36, 0xC0 ); //rgb
		write_reg(par, 0x36, 0x0  ); //rgb
		break;
//	}



	}

	return 0;
}

static struct fbtft_display display = {
	.regwidth = 8,
	.width = WIDTH,
	.height = HEIGHT,
//	.init_sequence = default_init_sequence,
	.fbtftops = {
		.set_addr_win = set_addr_win,
		.init_display = init_display,
		.set_gamma = set_gamma,
		.set_var = set_var,
	},
};

FBTFT_REGISTER_DRIVER(DRVNAME, "NV3041A", &display);

MODULE_ALIAS("spi:" DRVNAME);
MODULE_ALIAS("platform:" DRVNAME);
MODULE_ALIAS("spi:hd43017");
MODULE_ALIAS("platform:hd43017");

MODULE_DESCRIPTION("HD43017 LCD driver");
MODULE_AUTHOR("BTT <zhangym@biqu3d.com>");
MODULE_LICENSE("GPL v2");









